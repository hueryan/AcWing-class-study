[前后端身份验证问题](https://www.acwing.com/file_system/file/content/whole/index/content/10248701/) 

为了方便解决跨域身份验证问题，本章我们在之前的项目中集成 Django Rest Framework 和 JWT 身份验证。

1. [集成Django Rest Framework](./10Rest Framework与JWT身份验证/1.集成Django Rest Framework.md) 
2. [集成JWT验证](./10Rest Framework与JWT身份验证/2.集成JWT验证.md)
3. [配置Nginx](./10Rest Framework与JWT身份验证/3.配置Nginx.md)



---

## 操作

```sh
pip install djangorestframework==3.13.1 pyjwt==2.4 djangorestframework-simplejwt==5.1
```

```sh
vim ~/app/app/settings.py  # 引入 rest_framework
```

需要定期修改 `SIGNING_KEY` 的值!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

```sh
vim ~/app/game/urls/settings/index.py  # 修改api
python3 ~/app/manage.py collectstatic
rm ~/app/game/views/settings/logout.py ~/app/game/views/settings/login.py
vim ~/app/game/views/settings/getinfo.py  # 转化成jwt

vim ~/app/game/static/js/src/zbase.js  # 刷新refresh access
vim ~/app/game/templates/mutiends/web.html
vim ~/app/game/static/js/src/settings/zbase.js  # 判断有无令牌

vim ~/app/game/views/settings/acwing/web/receive_code.py  # 修改一键登录,构造jwt
vim ~/app/game/views/index.py
vim ~/app/game/templates/multiends/web.html  # 对应上个index.py的access, refresh

vim ~/app/game/views/settings/ranklist.py  # 增加排行
vim ~/app/game/urls/settings/index.py  # 增加路由
vim ~/app/game/views/settings/register.py
vim ~/app/game/urls/settings/index.py  # 修改路由
game/static/js/src/settings/zbase.js  # 修改register_on_remote

git commit -m "jwt ranklist on web" 
```

[Gitee-源码](https://gitee.com/hueryan/django-first/tree/0e65a0efa0d036e479d551090f9a810375cf5bd0) [Github-diff](https://github.com/hueryan/django-first/commit/0e65a0efa0d036e479d551090f9a810375cf5bd0) 

### Acapp端

```sh
vim ~/app/game/views/settings/acwing/acapp/receive_code.py
vim ~/app/game/static/js/src/settings/zbase.js  # 修改register_on_remote

git commit -m "jwt ranklist on acapp"
```

[Gitee-源码](https://gitee.com/hueryan/django-first/tree/fbc7fd77e3a3dd96a1726b381c0f9d97dd5f8a3d) [Github-diff](https://github.com/hueryan/django-first/commit/fbc7fd77e3a3dd96a1726b381c0f9d97dd5f8a3d) 

### ws实现令牌

```sh
vim ~/app/game/channelsmiddleware.py
vim ~/app/app/asgi.py  # 换成写的中间件
vim ~/app/game/consumers/multiplayer/index.py
vim ~/app/game/static/js/src/playground/socket/multiplayer/zbase.js  # 在WebSocket 增加token

git commit -m "ws_token"
```

[Gitee-源码](https://gitee.com/hueryan/django-first/tree/a06c3bfc57dfbc846e7ad34da7af262bcc62e1ee) [Github-diff](https://github.com/hueryan/django-first/commit/a06c3bfc57dfbc846e7ad34da7af262bcc62e1ee) 