`canvas` 渲染文本

```js
this.ctx.font = "20px serif";
this.ctx.fillStyle = "white";
this.ctx.textAlign = "center";
this.ctx.fillText("Hello HelloWorld", x, y);
```

![fireball.png](./assets/fireball.png)

![blink.png](./assets/blink.png)

将图片上传到服务器

```sh
scp *.png django_server:~/app/game/static/image/playground/
# 打包后可以通过连接访问
https://app165.acapp.acwing.com.cn/static/image/playground/fireball.png
https://app165.acapp.acwing.com.cn/static/image/playground/blink.png
```



---

**在AcApp端实现退出**

```sh
vim ~/app/game/static/js/src/settings/zbase.js

git commit -m "achieve exit at AcApp"
```

[Gitee-源码](https://gitee.com/hueryan/django-first/tree/da7cbf58e4f8f1ef67da71e0eb15453597bc8243) [Github-diff](https://github.com/hueryan/django-first/commit/da7cbf58e4f8f1ef67da71e0eb15453597bc8243) 

**实现move_to同步**

```sh
cd ~/app/game/static/js/src/playground/socket/multiplayer
vim zbase.js  # 修改前端
cd ~/app/game/consumers/multiplayer  
vim index.py  # 修改后端
cd ~/app/game/static/js/src/playground
vim zbase.js  # 记录模式
cd ~/app/game/static/js/src/playground/player
vim zbase.js  # 调用
# 20min 讲解move_to原理

git commit -m "implement the move_to broadcast to the server"
```

[Gitee-源码](https://gitee.com/hueryan/django-first/tree/361d9903b9aafe1cea444c61dd2d05d93b697dd6) [Github-diff](https://github.com/hueryan/django-first/commit/361d9903b9aafe1cea444c61dd2d05d93b697dd6) 

```txt
move-to 流程：

1.前端，当playground/player/zbase.js 中的函数监听到用户点击右键，首先在自己的页面上移动，如果是多人模式，那么则调用playground.mps对象的send_move_to函数，并传递目标点tx和ty，js/src/playground/zbase.js 中的send_move_to函数向后端发送event类型，uuid，目标点。
2.后端，consumers/multiplayer/index.py 的receive监听函数接收到数据，判断event类型，调用本文件内的move_to函数，群发通知，告诉所有玩家，当前玩家进行了移动。
3.前端，js/src/playground/zbase.js 中的receive监听函数接收到群发消息后，判断event类型，调用本文件内的receive_move_to函数，通过判断uuid将对应玩家移动到目标点。
```

**实现shoot_fireball同步**

```sh
cd ~/app/game/static/js/src/playground/player
vim zbase.js  
cd ~/app/game/static/js/src/playground/socket/multiplayer
vim zbase.js  # 实现send_receive  路由
cd ~/app/game/static/js/src/playground/skill/fireball
vim zbase.js  # 修改火球
cd ~/app/game/consumers/multiplayer  
vim index.py  # 修改后端

git commit -m "synchronize shoot_fireball"
```

[Gitee-源码](https://gitee.com/hueryan/django-first/tree/c8e4f49c6e7b5ba65ee10436db1ba32b414e94af) [Github-diff](https://github.com/hueryan/django-first/commit/c8e4f49c6e7b5ba65ee10436db1ba32b414e94af) 

```sh
shoot fireball 流程：

1.前端，当玩家点击q后，选中fireball技能，然后按下鼠标左键，playground/player/zbase.js 中的监听函数被触发，先在自己的页面上发射一个火球，然后判断如果是多人模式，则调用playground.mps对象的send_shoot_fireball函数, 并传递目标点和fireball的uuid，js/src/playground/socket/zbase.js 中的send_shoot_fireball得到数据后，将数据发送到后端。

2.后端，consumers/multiplayer/index.py 中的receive函数被触发，经过判断event类型，调用同文件夹中的hoot_fireball函数，将playground的uuid和fireball的uuid，以及其他数据，群发给其他玩家。

3.前端，js/src/playground/socket/zbase.js 中的receive函数被触发，经过判断event类型，调用同文件夹中的receive_shoot_fireball函数，根据数据中playground的uuid，找到对应玩家，然后调用该玩家的shoot_fireball函数，这样就能在其他玩家的页面上发射一个火球。
```

**实现attack同步**

```sh
cd ~/app/game/static/js/src/playground/skill/fireball
vim zbase.js  # 最后调用
cd ~/app/game/static/js/src/playground/socket/multiplayer
vim zbase.js
cd ~/app/game/static/js/src/playground/player
vim zbase.js  
cd ~/app/game/consumers/multiplayer  
vim index.py  # 修改后端

git commit -m "synchronize attack"
```

[Gitee-源码](https://gitee.com/hueryan/django-first/tree/a990e35dcd018c2d71d916cc89405d05bfb5ce85) [Github-diff](https://github.com/hueryan/django-first/commit/a990e35dcd018c2d71d916cc89405d05bfb5ce85) 

```
attack 流程：

1.前端，当玩家发出火球，并击中一名敌对玩家时，playground/skill/fireball/zbase.js 中的attack函数被调用，如果是多人模式，playground.mps对象的send_attack。js/src/playground/socket/acgame/zbase.js 中的mps对象的send_attack函数被调用，将event类型、攻击者/被击中者/火球的uuid，等 发送给后端。

2.后端，consumers/multiplayer/index.py 中的receive函数被调用，根据event类型，调用同文件下的attack函数，将数据打包并群发给所有玩家。

3.前端，js/src/playground/socket/acgame/zbase.js 中的mps对象的receive函数被调用，判断event类型，调用同文件下的receive_attack函数，根据uuid找到攻击者与被攻击的player对象，如果两个对象都还存在，则调用被攻击者(player类)的receive_attack函数，更新被攻击者的位置，删除攻击者的火球对象，同时将angel以及damage传递给自身的is_attacked函数。
```

**开局前不可移动、技能冷却**

```sh
cd ~/app/game/static/js/src/playground
vim zbase.js  # 同步玩家状态
mkdir notice_board
cd notice_board
vim zbase.js
cd ~/app/game/static/js/src/playground/player
vim zbase.js  # 设置玩家数量

cd ~/app/game/static/js/src/playground/player
vim zbase.js  # 设置技能

# 闪现同步
cd ~/app/game/static/js/src/playground/socket/multiplayer
vim zbase.js
cd ~/app/game/consumers/multiplayer
vim index.py  # 修改后端

git commit -m "implement blink & coldtime"
```

[Gitee-源码](https://gitee.com/hueryan/django-first/tree/6faa589bf8df4be7ae6840e064a3c095585bbed9) [Github-diff](https://github.com/hueryan/django-first/commit/6faa589bf8df4be7ae6840e064a3c095585bbed9) 

**优化了技能的coldtime小于esp置为0并且不会再刷新**

```sh
git commit -m "Optimize coldtime cost"
```

[Gitee-源码](https://gitee.com/hueryan/django-first/tree/8f5cc143cccadf0a8d72896153669493f86e2908) [Github-diff](https://github.com/hueryan/django-first/commit/8f5cc143cccadf0a8d72896153669493f86e2908) 

