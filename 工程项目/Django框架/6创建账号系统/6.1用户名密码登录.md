1. [AcWing Logo](https://app165.acapp.acwing.com.cn/static/image/settings/acwing_logo.png) 

2. `canvas` 用图片填充圆形

   ```js
   this.img = new Image();
   this.img.src = "图片地址";
   
   this.ctx.save();
   this.ctx.beginPath();
   this.ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
   this.ctx.stroke();
   this.ctx.clip();
   this.ctx.drawImage(this.img, this.x - this.radius, this.y - this.radius, this.radius * 2, this.radius * 2); 
   this.ctx.restore();
   ```

   

---

```sh
python3 ~/app/manage.py changepassword [user]  # 修改用户密码
python3 ~/app/manage.py shell  # Django 交互式
```

## 数据库

**扩充数据库表**

```sh
cd ~/app/game/models
mkdir player
touch player/__init__.py
vim player/player.py  # 存储player数据表的信息
vim ~/app/game/admin.py  # 将自定义的表注册
python3 ~/app/manage.py makemigrations  # 数据表定义更新之后
python3 ~/app/manage.py migrate  # 数据表定义更新之后, 此时自定义的表被应用到数据库中
ps aux | grep uwsgi
kill -9 [PID]
uwsgi --ini ~/app/scripts/uwsgi.ini  # 重启服务
git commit -m "create player_info"
```

[Gitee](https://gitee.com/hueryan/django-first/tree/4a1aef05b735b49ab11c9604200dfdc2b3f51e0a) [Github差异](https://github.com/hueryan/django-first/commit/4a1aef05b735b49ab11c9604200dfdc2b3f51e0a) 

### 登录逻辑

```sh
cd ~/app/game/static/js/src
vim zbase.js
cd ~/app/game/views/settings  # 函数
vim getinfo.py  # 修改用户名，头像等
cd ~/app/game/urls/settings  # 路由
vim index.py
cd ~/app/game/static/js/src/menu
vim zbase.js  # 隐藏菜单
cd ~/app/game/static/js/src/settings  
vim zbase.js  # 判断是否登录 这里和getinfo.py名称一直，里面有域名
cd cd ~/app/game/static/js/src/
vim zbase.js  # 创建settings
cd ~/app/game/views/settings  
vim getinfo.py  # 增加判断是否登录
git commit -m "judge (not) login"
```

[Gitee源码](https://gitee.com/hueryan/django-first/tree/2cf2215eef90444ef34241c5cbac45cca02c297f) [Github差异](https://github.com/hueryan/django-first/commit/2cf2215eef90444ef34241c5cbac45cca02c297f) 

注意：`把acapp/game/views/settings/getinfo.py里面的elif platform == "WEB" 改成 else:` 否则`域名/settings/getinfo` 报错`The view game.views.settings.getinfo.getinfo didn't return an HttpResponse object. It returned None instead.` 



**头像渲染到圈圈**

```sh
cd ~/app/game/static/js/src/settings  
vim zbase.js  # 添加user、photo属性
cd ~/app/game/static/js/src/playground/player
vim zbase.js  # 调用头像
git commit -m "render avatar"
```

真的图片问题！！！[用这个](https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fc-ssl.duitang.com%2Fuploads%2Fblog%2F202107%2F09%2F20210709142454_dc8dc.thumb.1000_0.jpeg&refer=http%3A%2F%2Fc-ssl.duitang.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1661779231&t=7fd32076) 

[Gitee源文件](https://gitee.com/hueryan/django-first/tree/2c1c92716f8aafe655be13d1dc264dbab6f1e487) [Github差异](https://github.com/hueryan/django-first/commit/2c1c92716f8aafe655be13d1dc264dbab6f1e487) 

**渲染登陆界面**

```sh
cd ~/app/game/static/js/src/settings  
vim zbase.js
cd ~/app/game/static/css
vim game.css
```

保存图片

```sh
cd ~/app/game/static/image/settings
wget https://app165.acapp.acwing.com.cn/static/image/settings/acwing_logo.png
```

```sh
git commit -m "Implement a static login and registration interface"
```

[Gitee源文件](https://gitee.com/hueryan/django-first/tree/e6565f4016c9cc7053b74116c704f121358119c9) [Github差别](https://github.com/hueryan/django-first/commit/e6565f4016c9cc7053b74116c704f121358119c9) 

**实现登录框、注册框静态切换**

```sh
cd ~/app/game/static/js/scr/settings/
vim zbase.js
git commit -m "Implement static switching between login and registration boxes"
```

[gitee源码](https://gitee.com/hueryan/django-first/tree/2cf0ba9210aaa2f3d8ea5ec083c875c119913a96) [Github-diff](https://github.com/hueryan/django-first/commit/2cf0ba9210aaa2f3d8ea5ec083c875c119913a96) 

**实现登录、注册逻辑**

```sh
# view  处理数据
cd ~/app/game/views/settings
vim login.py
vim logout.py
vim register.py
vim getinfo.py  # 修改获取头像条件
# urls 处理路由
cd ~/app/game/urls/settings
vim index.py
# js 前端调用
cd ~/app/game/static/js/src/settings
vim zbase.js  # .ajax有域名
```

```sh
cd ~/app/game/static/js/src/menu
vim zbase.js  # 将logout绑定到设置
git commit -m "Implement login logout and registration logic"
```

[Gitee源码](https://gitee.com/hueryan/django-first/tree/f11e77a87782daac2202ddeb4eecb35f50dd848d) [Github-diff](https://github.com/hueryan/django-first/commit/f11e77a87782daac2202ddeb4eecb35f50dd848d) 
