1.  增加容器的映射端口：80与443

   1. 登录容器，关闭所有运行中的任务。

   2. 登录运行容器的服务器，然后执行：

      ```sh
      docker commit CONTAINER_NAME django_lesson:1.1  # 将容器保存成镜像，将CONTAINER_NAME替换成容器名称
      docker stop CONTAINER_NAME  # 关闭容器
      docker rm CONTAINER_NAME # 删除容器
      
      # 使用保存的镜像重新创建容器
      docker run -p 20000:22 -p 8000:8000 -p 80:80 -p 443:443 --name CONTAINER_NAME -itd django_lesson:1.1
      ```

   3. 去云服务器控制台，在安全组配置中开放80和443端口。

---

2. 创建AcApp，获取域名、nginx配置文件及https证书

   打开[AcWing应用中心](https://www.acwing.com/file_system/file/content/whole/index/content/whole/application/1/) 点击创建应用

   系统分配的域名、nginx配置文件及https证书

   在`服务器IP`一栏填入自己服务器的ip地址。

   将`nginx.conf`中的内容写入服务器`/etc/nginx/nginx.conf`文件中。如果django项目路径与配置文件中不同，注意修改路径。
   将`acapp.key`中的内容写入服务器`/etc/nginx/cert/acapp.key`文件中。
   将`acapp.pem`中的内容写入服务器`/etc/nginx/cert/acapp.pem`文件中。

   然后启动nginx服务：

   ```sh
   sudo /etc/init.d/nginx start
   ```

---

3. 修改django项目的配置

   - 打开`settings.py`文件：

     - 将分配的域名添加到`ALLOWED_HOSTS`列表中。注意只需要添加`https://`后面的部分。
     - 令`DEBUG = False`。

   - 归档`static`文件：

     - ```sh
       python3 manage.py collectstatic
       ```

---

4. 配置uwsgi

   - 在django项目中添加uwsgi的配置文件：`scripts/uwsgi.ini`，内容如下：

     ```sh
     [uwsgi]
     socket          = 127.0.0.1:8000
     chdir           = /home/hujing/app
     wsgi-file       = app/wsgi.py
     master          = true
     processes       = 2
     threads         = 5
     vacuum          = true
     ```

     启动uwsgi服务：

     ```sh
     uwsgi --ini scripts/uwsgi.ini
     ```

---

5.  填写应用的剩余信息
   - 标题：应用的名称
   - 关键字：应用的标签（选填）
   - css地址：css文件的地址，例如：`https://app165.acapp.acwing.com.cn/static/css/game.css`
   - js地址：js文件的地址：例如：`https://app165.acapp.acwing.com.cn/static/js/dist/game.js`
   - 主类名：应用的main class，例如`AcGame`。
   - 图标：4:3的图片
   - 应用介绍：介绍应用，支持markdown + latex语法。

---

6. 填写完服务器IP之后，点“保存”或者“提交”按钮，均可使分配的域名生效。

---

7. 提交后点”打开应用”按钮，即可预览自己所写的应用





# 实操

域名：`https://app3749.acapp.acwing.com.cn/` 

关闭docker容器所有进程

进入服务器

```sh
ssh ali_server
docker commit [CONTAINER_NAME] django_lesson:1.1  # 将容器保存成镜像
docker images  # 显示1.1
docker stop [CONTAINER_NAME]  # 停止之前的容器
docker rm [CONTAINER_NAME]  # 删除之前的容器
docker run -p 20000:22 -p 8000:8000 -p 80:80 -p 443:443 --name [CONTAINER_NAME] -itd django_lesson:1.1

```

进入docker容器

```sh
ssh docker_server
sudo vim /etc/nginx/nginx.conf
```

```sh
user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
    worker_connections 768;
    # multi_accept on;
}

http {

    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;

    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE
    ssl_prefer_server_ciphers on;

    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    gzip on;

    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*;

     server {
         listen 80;
         server_name app3749.acapp.acwing.com.cn;
         rewrite ^(.*)$ https://${server_name}$1 permanent;
     }

    server {
        listen 443 ssl;
        server_name app3749.acapp.acwing.com.cn;
        ssl_certificate   cert/acapp.pem;
        ssl_certificate_key  cert/acapp.key;
        ssl_session_timeout 5m;
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_prefer_server_ciphers on;
        charset utf-8;
        access_log /var/log/nginx/access.log;
        error_log /var/log/nginx/error.log;

        client_max_body_size 10M;

        location / {
            include /etc/nginx/uwsgi_params;
            uwsgi_pass 127.0.0.1:8000;
            uwsgi_read_timeout 60;

            if ($request_method = 'OPTIONS') {
                add_header 'Access-Control-Allow-Origin' 'https://www.acwing.com';
                add_header 'Access-Control-Allow-Methods' 'GET, PUT, OPTIONS, POST, DELETE';
                add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-Amz-Date';
                add_header 'Access-Control-Max-Age' 86400;
                add_header 'Content-Type' 'text/html; charset=utf-8';
                add_header 'Content-Length' 0;
                return 204;
            }
            if ($request_method = 'PUT') {
                add_header 'Access-Control-Allow-Origin' 'https://www.acwing.com';
                add_header 'Access-Control-Allow-Methods' 'GET, PUT, OPTIONS, POST, DELETE';
                add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-Amz-Date';
                add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';
            }
            if ($request_method = 'GET') {
                add_header 'Access-Control-Allow-Origin' 'https://www.acwing.com';
                add_header 'Access-Control-Allow-Methods' 'GET, PUT, OPTIONS, POST, DELETE';
                add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-Amz-Date';
                add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';
            }
            if ($request_method = 'POST') {
                add_header 'Access-Control-Allow-Origin' 'https://www.acwing.com';
                add_header 'Access-Control-Allow-Methods' 'GET, PUT, OPTIONS, POST, DELETE';
                add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-Amz-Date';
                add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';
            }
            if ($request_method = 'DELETE') {
                add_header 'Access-Control-Allow-Origin' 'https://www.acwing.com';
                add_header 'Access-Control-Allow-Methods' 'GET, PUT, OPTIONS, POST, DELETE';
                add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-Amz-Date';
                add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';
            }
        }
        location /static {
            alias /home/hujing/app/static/;
            if ($request_method = 'OPTIONS') {
                add_header 'Access-Control-Allow-Origin' 'https://www.acwing.com';
                add_header 'Access-Control-Allow-Methods' 'GET, PUT, OPTIONS, POST, DELETE';
                add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-Amz-Date';
                add_header 'Access-Control-Max-Age' 86400;
                add_header 'Content-Type' 'text/html; charset=utf-8';
                add_header 'Content-Length' 0;
                return 204;
            }
            if ($request_method = 'PUT') {
                add_header 'Access-Control-Allow-Origin' 'https://www.acwing.com';
                add_header 'Access-Control-Allow-Methods' 'GET, PUT, OPTIONS, POST, DELETE';
                add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-Amz-Date';
                add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';
            }
            if ($request_method = 'GET') {
                add_header 'Access-Control-Allow-Origin' 'https://www.acwing.com';
                add_header 'Access-Control-Allow-Methods' 'GET, PUT, OPTIONS, POST, DELETE';
                add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-Amz-Date';
                add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';
            }
        }
        location /media {
            alias /home/hujing/app/media/;
            if ($request_method = 'OPTIONS') {
                add_header 'Access-Control-Allow-Origin' 'https://www.acwing.com';
                add_header 'Access-Control-Allow-Methods' 'GET, PUT, OPTIONS, POST, DELETE';
                add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-Amz-Date';
                add_header 'Access-Control-Max-Age' 86400;
                add_header 'Content-Type' 'text/html; charset=utf-8';
                add_header 'Content-Length' 0;
                return 204;
            }
            if ($request_method = 'PUT') {
                add_header 'Access-Control-Allow-Origin' 'https://www.acwing.com';
                add_header 'Access-Control-Allow-Methods' 'GET, PUT, OPTIONS, POST, DELETE';
                add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-Amz-Date';
                add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';
            }
            if ($request_method = 'GET') {
                add_header 'Access-Control-Allow-Origin' 'https://www.acwing.com';
                add_header 'Access-Control-Allow-Methods' 'GET, PUT, OPTIONS, POST, DELETE';
                add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-Amz-Date';
                add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';
            }
        }
        location /wss {
            proxy_pass http://127.0.0.1:5015;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Host $http_host;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }
    }
}
```

```sh
sudo mkdir /etc/nginx/cert/
sudo vim /etc/nginx/cert/acapp.key
sudo /etc/nginx/cert/acapp.pem
```

[acapp.key](-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAp5k9LQIa+2sMnxAkVYAYPaJJM8lrlUFuTKVqdIedtAWlI7cq
pcmyNfab/pohKU22Pt85L/GVIQCsDacvt3Q1M5lAyPkiVg0FtsBFva5yN7VZ/67n
Ma/kFal2XL82XMFIKoZdCrpWnt3GVuFwCiFmdkUtLlAafTf2/Wt8Ct3yIzXUefzp
6bwPxlbN/A4Uulf8wl9R+fIPUnC4HTO83MMSpX5eaKlUKwsiFkjRaj7DV8ryvnYj
WM0YZVElrD4jnNyCyIxX9Dz5XwmJcHY4GgHRy7ZLrDr0RcGhgQsVeC73S2AkiWQl
azGKstrxhqFn7s8ZyApENvdy9f9KBtsA9qmFWwIDAQABAoIBABhscehRsrnp1zyE
3y6gjKfKsw07cJSfJOJBhtp1eutlmTOzuSDQ3EoV5pS7RFLfEsxlvlE4zOkyzl/s
+byr0Cb1UeYXvEO7ARapPWCPf/CTWoqyo9lvTvdDK08HxHXO6uPbkcqC7iWXnxRB
JREs3eAlY5iorruJwNIcbEavIl6z+GDO2ISk5wxWaum9ZQelueZttwOvI0qhjRIG
3uSCQzTLWPdZQNqZxNc+dELZ8eifdh1cbxcsDZ6X+goXb1KlCzv8A4dKw5dccZeF
K4LRtdbb/jntYQd/+0weTEK+CYvEIlssprrxnyyzzC4PrZQX+th0sgiLd2kubuv5
andtdkkCgYEA42iywSIkPQ1bUTa8Kp+rhBOkbgG0pKUYXrF1G6tM3M3tfomTrS8g
c8zWjYcBBsXU43lbWUZ8VKJJqum2ImhaSbS46dPX2sn8OhQVZemP3zI5vPCMEqNb
W1+ZYxNePhntUlwQxCNfccfFJBJ/JLwkXlWzOD8XpF3/H8olNylAzmkCgYEAvKuB
bBZEe0rC+dn937rFu9aIPoTvRIo8JSmlOIX8nhyL/TDR9uuMjppqfdvBz4hlMyBQ
Sw3EqULiyyHqyHGS4qvQ+ikSaofPN78pGzS9ya4XMU6OwcRA94ypPWOx50oXPSWl
WhS1L2KwdNqZa3p2VI7OQwFxj0pB3GligdJzRSMCgYEAzR49xfiuqSboDCwLs4KL
6TjyYotFThDgF2GHWOq9DJjuM+mR+277nZfQmp2ALoS4zmlDHRZ3xLsRKYle0FBB
yCOrerWrCFySFizRVDhEnjSmYaazIYiZOaTULMpmgitOpbAHK3MgfveK+Ut5xT+y
qigw3HYENCzYlur1gHjETKkCgYAY9CYeAaP1GqJHIYnueWmFuo4ylqp+yjnCQIvV
ugL7dpMdXcOngOgKRGopU1OC+2tHI9L62ktUh8AvVcET2dGvoUH2lFAXPvctTF9H
deZUMm5m2xkOj8J3+2a28+SnzqjcMYp5K5v7NHZaPj9kc8IK1Qh63EoExbGIUXfx
67/LOQKBgE3Oq73DpPXYECivN0RqEjjfuLPYq6WvBTTvisCdjMiKJEqyfjtfRItz
uFt1/6fTnXO2iwc7/7gK8qGnOYkznkCiUO+I1rzriHymGz9hRj+TEkqe3lD8dGGh
o1NKSZ7HcPt2xmliuk/dtjxB6tRLTeb2jyaEL/z3DL/y4+v7zBor
-----END RSA PRIVATE KEY-----) [acapp.pem](-----BEGIN CERTIFICATE-----
MIIGPzCCBSegAwIBAgIQBFdk/eZj4k62rntG2Wd3kDANBgkqhkiG9w0BAQsFADBg
MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3
d3cuZGlnaWNlcnQuY29tMR8wHQYDVQQDExZSYXBpZFNTTCBUTFMgUlNBIENBIEcx
MB4XDTI1MTEwMTAwMDAwMFoXDTI2MTIwMjIzNTk1OVowIDEeMBwGA1UEAwwVKi5h
Y2FwcC5hY3dpbmcuY29tLmNuMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC
AQEAp5k9LQIa+2sMnxAkVYAYPaJJM8lrlUFuTKVqdIedtAWlI7cqpcmyNfab/poh
KU22Pt85L/GVIQCsDacvt3Q1M5lAyPkiVg0FtsBFva5yN7VZ/67nMa/kFal2XL82
XMFIKoZdCrpWnt3GVuFwCiFmdkUtLlAafTf2/Wt8Ct3yIzXUefzp6bwPxlbN/A4U
ulf8wl9R+fIPUnC4HTO83MMSpX5eaKlUKwsiFkjRaj7DV8ryvnYjWM0YZVElrD4j
nNyCyIxX9Dz5XwmJcHY4GgHRy7ZLrDr0RcGhgQsVeC73S2AkiWQlazGKstrxhqFn
7s8ZyApENvdy9f9KBtsA9qmFWwIDAQABo4IDMzCCAy8wHwYDVR0jBBgwFoAUDNts
gkkPSmcKuBTuesRIUojrVjgwHQYDVR0OBBYEFGaKo9er8vom7g5XQOAfGmGD+5DX
MDUGA1UdEQQuMCyCFSouYWNhcHAuYWN3aW5nLmNvbS5jboITYWNhcHAuYWN3aW5n
LmNvbS5jbjA+BgNVHSAENzA1MDMGBmeBDAECATApMCcGCCsGAQUFBwIBFhtodHRw
Oi8vd3d3LmRpZ2ljZXJ0LmNvbS9DUFMwDgYDVR0PAQH/BAQDAgWgMB0GA1UdJQQW
MBQGCCsGAQUFBwMBBggrBgEFBQcDAjA/BgNVHR8EODA2MDSgMqAwhi5odHRwOi8v
Y2RwLnJhcGlkc3NsLmNvbS9SYXBpZFNTTFRMU1JTQUNBRzEuY3JsMHYGCCsGAQUF
BwEBBGowaDAmBggrBgEFBQcwAYYaaHR0cDovL3N0YXR1cy5yYXBpZHNzbC5jb20w
PgYIKwYBBQUHMAKGMmh0dHA6Ly9jYWNlcnRzLnJhcGlkc3NsLmNvbS9SYXBpZFNT
TFRMU1JTQUNBRzEuY3J0MAwGA1UdEwEB/wQCMAAwggF+BgorBgEEAdZ5AgQCBIIB
bgSCAWoBaAB2ANgJVTuUT3r/yBYZb5RPhauw+Pxeh1UmDxXRLnK7RUsUAAABmj91
+PsAAAQDAEcwRQIgcNHzZ4pL3B/xCASZai5toYcz5pZAH57lkkCoh7jkGzkCIQCs
hGD58j0vbr8FA29z4fqLTl+lrgZ/f8Lel+uB6KoW8gB3AMIxfldFGaNF7n843rKQ
QevHwiFaIr9/1bWtdprZDlLNAAABmj91+Q4AAAQDAEgwRgIhAKCd7QtYAvZCcTB5
VoAnlaV3z2aoNCRBiUYgXI9/sSa2AiEA7pBjGq0ptWBzO7hv4RqBdrLWXiDtPH24
4aSQu5aih3UAdQCUTkOH+uzB74HzGSQmqBhlAcfTXzgCAT9yZ31VNy4Z2AAAAZo/
dfkvAAAEAwBGMEQCIAbOwkIaCQ+SQyMYg/buFDdm2NjtE1gb6CfsnUauxPZ+AiBm
LB1v8j6oRUzMWpzwciekMIeiDA4JClzzJCBKtSQy3zANBgkqhkiG9w0BAQsFAAOC
AQEAid5j+ZlB84N40hpwoS0Ur2f6s7Arr+nkN4R5IR1A6FardxyNhBZTRtVvfkJF
Bt4JS59aIw/oN8FC9GDIVndfzpXKhqrdU1Yuyx1uNoefarq4vaR0eAengg0EBeyw
rOW4IGn/d9ls+zeH/qHT7/j7yKtJGU4uqkeLBQXs5M6odjt/yDBjU8B06xCDt1QC
yCISQHfnksT/ycQrkT1BmPh/fT0Ku73JLgTlNKD3GEqxMZXv7dtV9H7iDl6cB2X0
nvO96WfWA8VUAhV4axIjXxJN6riLv7XJNZ7kUXAVCi6fcmvsccQNDZd96em5xqty
nTyc+8RetrEWvpWAos1c9zQ2Fw==
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIEszCCA5ugAwIBAgIQCyWUIs7ZgSoVoE6ZUooO+jANBgkqhkiG9w0BAQsFADBh
MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3
d3cuZGlnaWNlcnQuY29tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBH
MjAeFw0xNzExMDIxMjI0MzNaFw0yNzExMDIxMjI0MzNaMGAxCzAJBgNVBAYTAlVT
MRUwEwYDVQQKEwxEaWdpQ2VydCBJbmMxGTAXBgNVBAsTEHd3dy5kaWdpY2VydC5j
b20xHzAdBgNVBAMTFlJhcGlkU1NMIFRMUyBSU0EgQ0EgRzEwggEiMA0GCSqGSIb3
DQEBAQUAA4IBDwAwggEKAoIBAQC/uVklRBI1FuJdUEkFCuDL/I3aJQiaZ6aibRHj
ap/ap9zy1aYNrphe7YcaNwMoPsZvXDR+hNJOo9gbgOYVTPq8gXc84I75YKOHiVA4
NrJJQZ6p2sJQyqx60HkEIjzIN+1LQLfXTlpuznToOa1hyTD0yyitFyOYwURM+/CI
8FNFMpBhw22hpeAQkOOLmsqT5QZJYeik7qlvn8gfD+XdDnk3kkuuu0eG+vuyrSGr
5uX5LRhFWlv1zFQDch/EKmd163m6z/ycx/qLa9zyvILc7cQpb+k7TLra9WE17YPS
n9ANjG+ECo9PDW3N9lwhKQCNvw1gGoguyCQu7HE7BnW8eSSFAgMBAAGjggFmMIIB
YjAdBgNVHQ4EFgQUDNtsgkkPSmcKuBTuesRIUojrVjgwHwYDVR0jBBgwFoAUTiJU
IBiV5uNu5g/6+rkS7QYXjzkwDgYDVR0PAQH/BAQDAgGGMB0GA1UdJQQWMBQGCCsG
AQUFBwMBBggrBgEFBQcDAjASBgNVHRMBAf8ECDAGAQH/AgEAMDQGCCsGAQUFBwEB
BCgwJjAkBggrBgEFBQcwAYYYaHR0cDovL29jc3AuZGlnaWNlcnQuY29tMEIGA1Ud
HwQ7MDkwN6A1oDOGMWh0dHA6Ly9jcmwzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydEds
b2JhbFJvb3RHMi5jcmwwYwYDVR0gBFwwWjA3BglghkgBhv1sAQEwKjAoBggrBgEF
BQcCARYcaHR0cHM6Ly93d3cuZGlnaWNlcnQuY29tL0NQUzALBglghkgBhv1sAQIw
CAYGZ4EMAQIBMAgGBmeBDAECAjANBgkqhkiG9w0BAQsFAAOCAQEAGUSlOb4K3Wtm
SlbmE50UYBHXM0SKXPqHMzk6XQUpCheF/4qU8aOhajsyRQFDV1ih/uPIg7YHRtFi
CTq4G+zb43X1T77nJgSOI9pq/TqCwtukZ7u9VLL3JAq3Wdy2moKLvvC8tVmRzkAe
0xQCkRKIjbBG80MSyDX/R4uYgj6ZiNT/Zg6GI6RofgqgpDdssLc0XIRQEotxIZcK
zP3pGJ9FCbMHmMLLyuBd+uCWvVcF2ogYAawufChS/PT61D9rqzPRS5I2uqa3tmIT
44JhJgWhBnFMb7AGQkvNq9KNS9dd3GWc17H/dXa1enoxzWjE0hBdFjxPhUb0W3wi
8o34/m8Fxw==
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIEfjCCA2agAwIBAgIQD+Ayq4RNAzEGxQyOE8iwaDANBgkqhkiG9w0BAQsFADBh
MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3
d3cuZGlnaWNlcnQuY29tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBD
QTAeFw0yNDAxMTgwMDAwMDBaFw0zMTExMDkyMzU5NTlaMGExCzAJBgNVBAYTAlVT
MRUwEwYDVQQKEwxEaWdpQ2VydCBJbmMxGTAXBgNVBAsTEHd3dy5kaWdpY2VydC5j
b20xIDAeBgNVBAMTF0RpZ2lDZXJ0IEdsb2JhbCBSb290IEcyMIIBIjANBgkqhkiG
9w0BAQEFAAOCAQ8AMIIBCgKCAQEAuzfNNNx7a8myaJCtSnX/RrohCgiN9RlUyfuI
2/Ou8jqJkTx65qsGGmvPrC3oXgkkRLpimn7Wo6h+4FR1IAWsULecYxpsMNzaHxmx
1x7e/dfgy5SDN67sH0NO3Xss0r0upS/kqbitOtSZpLYl6ZtrAGCSYP9PIUkY92eQ
q2EGnI/yuum06ZIya7XzV+hdG82MHauVBJVJ8zUtluNJbd134/tJS7SsVQepj5Wz
tCO7TG1F8PapspUwtP1MVYwnSlcUfIKdzXOS0xZKBgyMUNGPHgm+F6HmIcr9g+UQ
vIOlCsRnKPZzFBQ9RnbDhxSJITRNrw9FDKZJobq7nMWxM4MphQIDAQABo4IBMDCC
ASwwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUTiJUIBiV5uNu5g/6+rkS7QYX
jzkwHwYDVR0jBBgwFoAUA95QNVbRTLtm8KPiGxvDl7I90VUwDgYDVR0PAQH/BAQD
AgGGMHQGCCsGAQUFBwEBBGgwZjAjBggrBgEFBQcwAYYXaHR0cDovL29jc3AuZGln
aWNlcnQuY24wPwYIKwYBBQUHMAKGM2h0dHA6Ly9jYWNlcnRzLmRpZ2ljZXJ0LmNu
L0RpZ2lDZXJ0R2xvYmFsUm9vdENBLmNydDBABgNVHR8EOTA3MDWgM6Axhi9odHRw
Oi8vY3JsLmRpZ2ljZXJ0LmNuL0RpZ2lDZXJ0R2xvYmFsUm9vdENBLmNybDARBgNV
HSAECjAIMAYGBFUdIAAwDQYJKoZIhvcNAQELBQADggEBAHRBl3jN7+XHBUK0dZnu
hMdoNwD1nCROU3BTIh1TNzRI0bQ0m5+C/dCRzzlqoSAFHUlOi+OiDltWkXTzmQn6
Z8bH5PFBy5sYpc/8cNPoSzhyqcpvvEZvv/Ivc0Up+dzma7vBDJC9WrMRUUlSFSQp
kdXSmphDNkXJsgARmxzc18IN6LYMRiOWlY7RE2F900pPW60BvJHHNCX0bbSRj/Ql
bmVq8wuftBD++D+RS8K++ujpMjFBROyWfBX+woQDGsMazkmgulQdnZrdj476elOL
axRvrSgEorju1kJM7M65z2RUZrfzQYW/1rs8mRUXin6iEtad/Rv1ZI1WGYmWPyBm
pbo=
-----END CERTIFICATE-----) 

**启动Nginx**

```sh
sudo /etc/init.d/nginx start
sudo nginx -s reload
```

**修改Settings**

```sh
cd ~/app/app
vim settings.py  # ALLOWED_HOSTS, DEBUG
cd ~/app
python3 manage.py collectstatic
```

**配置uwsgi**

```sh
cd ~/app/
vim scripts/uwsgi.ini
```

```
[uwsgi]
socket          = 127.0.0.1:8000
chdir           = /home/hujing/app
wsgi-file       = app/wsgi.py
master          = true
processes       = 2
threads         = 5
vacuum          = true
```

```sh
uwsgi --ini scripts/uwsgi.ini  # 运行时候一定要关闭之前的服务执行 pkill -f "manage.py runserver"
```

[css地址](https://app3749.acapp.acwing.com.cn/static/css/game.css) [js地址](https://app3749.acapp.acwing.com.cn/static/js/dist/game.js) 

## 修复Bug

增加左上角相对位置



```
python3 manage.py collectstatic
```

[Gitee源文件](https://gitee.com/hueryan/django-first/tree/d846a3f1ef5cf39b4449523c474ab475828135ff) [Github差异](https://github.com/hueryan/django-first/commit/91c61d69f984d2564e2245692cbda17064f912a2) 

## 上线应用打包

[github](https://github.com/hueryan/django-first/tree/7b5bf36840f7503ff7b22bdeac200efb84b8bd23)  

```
~/app/scripts/compress_game_js.sh
uwsgi --ini ~/app/scripts/uwsgi.ini
```

**修改加载逻辑以及菜单显示** 主要是`playground/zbase.js`和`.css`文件

```sh
git commit -m "Modify the loading logic and menu display"
```

[gitee源文件](https://gitee.com/hueryan/django-first/tree/2071e7e9b5d8f00f8077312bcc18efab9e6c7441) [Github差异](https://github.com/hueryan/django-first/commit/2071e7e9b5d8f00f8077312bcc18efab9e6c7441)

## 问题

**问题1**：出现访问网站白屏的现象，可能是有自己的域名或者自己的用户名没有修改nginx.conf导致的，链接是修改方案

[解决方案](https://www.acwing.com/file_system/file/content/whole/index/content/3341142/) 



**问题2：**此时也已可通过 `https://ip`访问

```
可以去看下nginx.conf这个配置文件里的server块。整个流程大概是：当在地址栏输入域名时，会默认使用http的80端口进行访问，在这个nginx配置中，来自80端口的请求又被转到了443端口，在443端口的处理中，这个请求又会被代理到uwsgi服务器上，uwsgi则会把这个请求通过127.0.0.1（localhost）的8000端口转到django，最终成功返回结果。

输入ip地址不能访问的原因是:当你直接输入ip地址时，会默认使用80端口访问，而由于nginx的80端口没有配置你的ip只配置了域名，因此就只能通过域名而不能通过ip地址来访问。如果你想通过ip地址直接访问可以仿照nginx.conf第一个server块，并将里面的server_name改成你的ip地址，添加到nginx.conf中，然后重载文件即可。

通过输入https://+ip能访问的原因是:这相当于使用443端口进行访问，因此这个请求会在第二个server块中被代理到uwsgi，所以能成功访问。（通过这种方式访问会有安全警告就是因为在这个443端口处理中没有通过证书验证）

```

