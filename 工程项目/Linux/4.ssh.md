## 教程

### ssh登录

#### 基本用法

远程登录服务器：

```
ssh user@hostname
```

- `user` 用户名
- `hostname` IP地址或域名

第一次登录时会提示：

```sh
The authenticity of host '123.57.47.211 (123.57.47.211)' can't be established.
ECDSA key fingerprint is SHA256:iy237yysfCe013/l+kpDGfEG9xxHxm0dnxnAbJTPpG8.
Are you sure you want to continue connecting (yes/no/[fingerprint])?
```

输入`yes` ，然后回车即可。
这样会将该服务器的信息记录在`~/.ssh/known_hosts` 文件中。

然后输入密码即可登录到远程服务器中。

---

默认登录端口号为22。如果想登录某一特定端口：

```sh
ssh user@hostname -p 22
```

#### 配置文件

创建配置文件`~/.ssh/config`

然后在文件中输入：

```sh
Host myserver1
    HostName IP地址或域名
    User 用户名

Host myserver2
    HostName IP地址或域名
    User 用户名
```

之后再使用服务器时，可以直接使用别名`myserver1`、`myserver2`。

#### 密钥登录

创建密钥：`ssh-keygen` 

然后一直回车即可。

执行结束后，`~/.ssh/`目录下会多两个文件：

- `id_rsa`：私钥
- `id_rsa.pub`：公钥

之后想免密码登录哪个服务器，就将公钥传给哪个服务器即可。

例如，想免密登录`myserver`服务器。则将公钥中的内容，复制到`myserver`中的`~/.ssh/authorized_keys`文件里即可。

也可以使用如下命令一键添加公钥：`ssh-copy-id myserver`

#### 执行命令

命令格式：

```sh
ssh user@hostname command
```

例如：

```sh
ssh user@hostname ls -a
```

或者

```sh
# 单引号中的$i可以求值
ssh myserver 'for ((i = 0; i < 10; i ++ )) do echo $i; done'
```

或者

```sh
# 双引号中的$i不可以求值
ssh myserver "for ((i = 0; i < 10; i ++ )) do echo $i; done"
```

### scp传文件

#### 基本用法

```sh
scp source destination
```

将 `source` 路径下的文件复制到`destination`中 

一次复制多个文件：

```sh
scp source1 source2 destination
```

复制文件夹：

```sh
scp -r ~/tmp myserver:/home/acs/
```

将本地家目录中的`tmp`文件夹复制到`myserver`服务器中的`/home/acs/`目录下。

```sh
scp -r ~/tmp myserver:homework/acs
```

将`myserver`服务器中的`~/homework/`文件夹复制到本地的当前路径下。

```sh
scp -r myserver:homework .
```

---

指定服务器的端口号：

```sh
scp -P 22 source1 source2 destination
```

---

注意： `scp`的`-r -P`等参数尽量加在`source`和`destination`之前。

---

使用`scp`配置其他服务器的`vim`和`tmux`

```sh
scp ~/.vimrc ~/.tmux.conf myserver:
```



## 作业

 **获取ssh教程配套的远程服务器账号的信息：**

`homework 4 getinfo` 

创建好作业后，先进入文件夹`/home/acs/homework/lesson_4/`，然后：

0. 进入homework_0文件夹，要求：

   ```sh
   [1] 该文件夹内容为空
   [2] 配置服务器账号的密钥登陆方式。服务器信息可以通过如下命令获得：
   homework 4 getinfo
   将服务器账号的名称（Host）配置成：myserver
   ```

   ```sh
   vim ~/.ssh/config
   
   Host mysrever
   	HostName xxx.xxx.xxx.xxx
   	User acs_xxx
   ```

   

1. 进入homework_1文件夹，下列描述中的“本地”均表示当前文件夹。要求：

   ```
   [1] 在myserver服务器上创建并清空文件夹：~/homework/lesson_4/homework_1/
   [2] 将本地的main.cpp文件上传到myserver中的~/homework/lesson_4/homework_1/目录中。
   [3] 在本地创建文件夹dir。
   [4] 将myserver中的/etc/lsb-release文件复制到dir中。
   ```

   ```sh
   ssh myserver 
   mkdir -p ~/homework/lesson_4/homework_1/  
   exit
   scp main.cpp myserver:~/homework/lesson_4/homework_1/
   mkdir dir 
   scp myserver:/etc/lsb-release ./dir
   ```

   

2. 进入homework_2文件夹，下列描述中的“本地”均表示当前文件夹，要求：

   ```
   [1] 在myserver服务器上创建并清空文件夹：~/homework/lesson_4/homework_2/
   [2] 将本地的dir文件夹上传到myserver中的~/homework/lesson_4/homework_2/目录中。
   ```

   ```sh
   ssh myserver 'mkdir ~/homework/lesson_4/homework_2/'
   scp -r dir/ myserver:~/homework/lesson_4/homework_2/
   ```

3. 进入homework_3文件夹，下列描述中的“本地”均表示当前文件夹，要求：

   ```
   [1] 在本地创建文件夹dir。
   [2] 将myserver中的/var/lib/locales/supported.d文件夹下载到本地dir文件夹中。
   ```

   ```sh
   mkdir dir
   scp -r myserver:/var/lib/locales/supported.d ./dir
   ```

   

4. 进入homework_4文件夹，编写脚本remote_mkdir.sh和remote_rmdir.sh，要求：

   ```
   [1] 在myserver服务器上创建并清空文件夹：~/homework/lesson_4/homework_4/
   [2] 本地目录下仅包含remote_mkdir.sh和remote_rmdir.sh
   [3] remote_mkdir.sh和remote_rmdir.sh具有可执行权限
   [4] remote_mkdir.sh接收一个传入参数。格式为 ./remote_mkdir.sh directory_name
   该操作可以在myserver服务器上的~/homework/lesson_4/homework_4/目录下，创建一个名为directory_name的文件夹
   [5] remote_rmdir.sh接收一个传入传输。格式为 ./remote_rmdir.sh directory_name
   该操作可以将myserver服务器上的~/homework/lesson_4/homework_4/目录下的名为directory_name的文件夹删掉。
   [6] 注意：传入的文件参数可能包含空格。两个脚本均不需要判断传入参数的合法性。
   ```

   ```sh
   ssh myserver 'mkdir ~/homework/lesson_4/homework_4/'
   touch remote_mkdir.sh remote_rmdir.sh
   chmod +x remote_mkdir.sh remote_rmdir.sh
   
   remote_mkmdir.sh
   [
   #! /bin/bash
   ssh myserver mkdir -p homework/lesson_4/homework_4/\"$1\"
   ]
   remote_rmdir.sh
   [
   #! /bin/bash
   ssh myserver rm -r homework/lesson_4/homework_4/\"$1\"
   ]
   ```

   



