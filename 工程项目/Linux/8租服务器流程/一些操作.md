```sh
cat /proc/cpuinfo  # 查看 cpu 信息
adduser hujing  # 创建用户
usermod -aG sudo hujing  # 给用户分配 sudo 权限
# 配置免密登录
```

本地

```sh
ssh-keygen
vim ~/.ssh/config
<---
Host ali_server
	HostName ip
	User hujing
--->
ssh-copy-id ali_server
scp ~/.bashrc ~/.vimrc ~/.tmux.conf ali_server:
ssh ali_server
```

云端

[docker安装官网](https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository) 

```sh
sudo apt update
sudo apt install tmux
# 根据教程安装 docker 
sudo usermod -aG docker $USER
apt install tree
apt install python3
apt install ipython3
```

# docker使用

### 配置docker镜像源

```
sudo vim /etc/docker/daemon.json
# 添加在阿里获取的镜像源地址：https://cr.console.aliyun.com/cn-guangzhou/instances/mirrors
<---
{
    "registry-mirrors": [
            "https://docker.m.daocloud.io",
            "https://docker.1panel.live"
      ]
}
---> 截至25.12.27可以使用
# 重新加载
sudo systemctl daemon-reload
sudo systemctl restart docker
```

## docker镜像

### 拉取、删除镜像

```sh
docker pull ubuntu:22.04  # 拉取镜像
docker rmi ubuntu:22.04  # 删除镜像
```

### 镜像迁移

```sh
# 镜像迁移
# 云端
docker save -o ubuntu_20_04.tar ubuntu:20.04  # 保存镜像
chmod +r ubuntu_20_04.tar
[Ctrl + D]
# 本地
scp ali_server:ubuntu_20_04.tar .
scp ubuntu_20_04.tar huawei_server:
ssh huawei_server
# 云端
docker load -i ubuntu_20_04.tar # 加载镜像
```

## docker容器

docker create [命令](https://docs.docker.com/reference/cli/docker/container/create/)  

docker update [命令](https://docs.docker.com/engine/reference/commandline/update) 

```sh
docker ps -a  # 查看所有容器
docker create -it ubuntu:22.04  # 通过 ubuntu:22.04 创建容器
docker start [CONTAINER ID/NAMES]  # 运行id的容器
docker stop [CONTAINER ID/NAMES]  
docker restart [CONTAINER ID/NAMES]  
docker run -itd ubuntu:22.04  # 创建并运行容器，如果不加 d 直接进入docker容器
docker attach [NAMES/ID]  # 进入一个正在运行的容器
    - 先按 Ctrl+p, 再按Ctrl+q 可以挂起容器
    - 直接按 Ctrl+d，退出并关闭容器
docker exec [CONTAINER ID/NAMES] ls  # 直接在服务器执行ls，此时容器需运行，在容器内部环境
docker rm [CONTAINER ID/NAMES]  # 删除容器
docker container prune  # 删除所有已停止的容器
docker export -o tmp.tar [CONTAINER ID/NAMES]  # 将容器打包，可以通过 scp 传到其他服务器
chmod +r tmp.tar  # 加可读权限
docker import xxx.tar image_name:tag  # 将本地文件xxx.tar导入成镜像，并将镜像命名为image_name:tag
docker export/import与docker save/load的区别：
	- export/import会丢弃历史记录和元数据信息，仅保存容器当时的快照状态
	- save/load会保存完整记录，体积更大
docker top [CONTAINER ID/NAMES]  # top正在运行的容器，监控查看容器进程，宿主机视角
docker starts  # 查看所有容器的统计信息，包括CPU、内存、存储、网络等信息
docker cp xxx [CONTAINER ID/NAMES]:[可选路径]xxx  # 将本地xxx复制到容器
docker cp [CONTAINER ID/NAMES]:[可选路径]xxx xxx  # 将容器xxx复制到本地
docker rename [原NAME] [新NAME]  # 修改容器名称
docker status  # 查看容器大小
docker update [CONTAINER ID/NAMES] --memory 1000M  # 修改容器大小
```

# 实操

在AC Terminal 操作

```sh
scp /var/lib/acwing/docker/images/docker_lesson_1_0.tar ali_server:
ssh server_name  # 登录自己的云端服务器
docker load -i docker_lesson_1_0.tar  # 将镜像加载到本地
docker run -p 20000:22 --name my_docker_server -itd docker_lesson:1.0  # 创建并运行docker_lesson:1.0镜像

docker attach my_docker_server  # 进入创建的docker容器
passwd  # 设置root密码
```

```sh
ssh root@ip -p 20000
adduser acs
usermod -aG sudo acs
# 退出
ssh ~/.ssh/config
<---
Host ali_server_docker
  HostName ip
  User acs
  Port 20000
--->
ssh-copy-id ali_server_docker
ssh acs@ip -p 20000
```

# 问题

1. 重装后大概率遇到的问题

    ```
    ssh-keygen -R [ip]  # 清除原来密钥对
    ```
2. 当安装docker显示没有`docker.asc` 
    ```
    [sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc]  # 根据文档执行
    # 执行后没有文件，可以直接下载到电脑上，然后传过去
    ```

